export const metadata = {
  title: 'Collections - SonicJS',
  description:
    'Define content types with TypeScript schemas, field validation, and automatic API generation. Learn how to create custom collections in SonicJS.',
}

export const sections = [
  { title: 'Overview', id: 'overview' },
  { title: 'Creating Collections', id: 'creating-collections' },
  {
    title: 'Creating via Admin UI',
    id: 'option-1-creating-collections-via-admin-ui',
  },
  {
    title: 'Creating with Code',
    id: 'option-2-creating-collections-with-code',
  },
  { title: 'When to Use Each Approach', id: 'when-to-use-each-approach' },
  { title: 'Field Types', id: 'field-types' },
  { title: 'Validation', id: 'validation' },
  { title: 'Examples', id: 'examples' },
]

# Collections

Define content types with TypeScript schemas and field validation. Collections are the foundation of your content model in SonicJS. {{ className: 'lead' }}

## Overview

<div className="not-prose mb-8 rounded-2xl border border-emerald-500/20 bg-emerald-50/50 p-5 dark:border-emerald-500/30 dark:bg-emerald-500/5">
  <div className="flex gap-4">
    <span className="flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-emerald-500/10 text-xl">
      ‚ú®
    </span>
    <div>
      <h4 className="mb-1 font-semibold text-emerald-900 dark:text-emerald-200">
        Unique Flexibility
      </h4>
      <span className="text-sm text-emerald-800 dark:text-emerald-300">
        Unlike most headless CMS platforms that only support one approach,
        SonicJS lets you create collections <strong>both</strong> through the
        admin UI and with code. Start prototyping in the UI, then migrate to
        code for production‚Äîor use both simultaneously.
      </span>
    </div>
  </div>
</div>

Collections define your content types using TypeScript schemas. Each collection automatically gets:

- Type-safe database schema
- Automatic API endpoints
- Admin UI for content management
- Field validation and constraints
- Version control through git

### Two Types of Collections

<div className="not-prose my-8 grid gap-6 sm:grid-cols-2">
  <div className="relative rounded-2xl border border-violet-500/20 bg-violet-50/50 p-6 dark:border-violet-500/30 dark:bg-violet-500/5">
    <div className="flex items-center gap-3 mb-4">
      <span className="flex h-10 w-10 items-center justify-center rounded-full bg-violet-500/10 text-xl">
        üíª
      </span>
      <h4 className="font-semibold text-violet-900 dark:text-violet-200">Code-Based Collections</h4>
    </div>
    <ul className="space-y-2 text-sm text-violet-800 dark:text-violet-300">
      <li className="flex items-start gap-2">
        <span className="text-violet-500 mt-0.5">‚úì</span>
        <span>Defined in TypeScript files (<code className="text-xs bg-violet-100 dark:bg-violet-900/50 px-1 rounded">src/collections/*.collection.ts</code>)</span>
      </li>
      <li className="flex items-start gap-2">
        <span className="text-violet-500 mt-0.5">‚úì</span>
        <span>Version controlled with your codebase</span>
      </li>
      <li className="flex items-start gap-2">
        <span className="text-violet-500 mt-0.5">‚úì</span>
        <span>Automatically synced on app startup</span>
      </li>
      <li className="flex items-start gap-2">
        <span className="text-violet-500 mt-0.5">‚úì</span>
        <span>Read-only in admin UI (marked with "Config" badge)</span>
      </li>
      <li className="flex items-start gap-2">
        <span className="text-violet-500 mt-0.5">‚úì</span>
        <span>Full TypeScript support with IDE autocomplete</span>
      </li>
    </ul>
    <div className="mt-4 pt-4 border-t border-violet-200 dark:border-violet-800">
      <span className="text-xs font-medium text-violet-600 dark:text-violet-400">Best for: Production apps, teams, CI/CD</span>
    </div>
  </div>

  <div className="relative rounded-2xl border border-amber-500/20 bg-amber-50/50 p-6 dark:border-amber-500/30 dark:bg-amber-500/5">
    <div className="flex items-center gap-3 mb-4">
      <span className="flex h-10 w-10 items-center justify-center rounded-full bg-amber-500/10 text-xl">
        üñ±Ô∏è
      </span>
      <h4 className="font-semibold text-amber-900 dark:text-amber-200">UI-Created Collections</h4>
    </div>
    <ul className="space-y-2 text-sm text-amber-800 dark:text-amber-300">
      <li className="flex items-start gap-2">
        <span className="text-amber-500 mt-0.5">‚úì</span>
        <span>Created and edited through the admin interface</span>
      </li>
      <li className="flex items-start gap-2">
        <span className="text-amber-500 mt-0.5">‚úì</span>
        <span>Stored directly in the database</span>
      </li>
      <li className="flex items-start gap-2">
        <span className="text-amber-500 mt-0.5">‚úì</span>
        <span>Fully editable in the UI anytime</span>
      </li>
      <li className="flex items-start gap-2">
        <span className="text-amber-500 mt-0.5">‚úì</span>
        <span>No code or deployment required</span>
      </li>
      <li className="flex items-start gap-2">
        <span className="text-amber-500 mt-0.5">‚úì</span>
        <span>Great for rapid prototyping</span>
      </li>
    </ul>
    <div className="mt-4 pt-4 border-t border-amber-200 dark:border-amber-800">
      <span className="text-xs font-medium text-amber-600 dark:text-amber-400">Best for: Prototyping, non-developers, quick iterations</span>
    </div>
  </div>
</div>

---

## Creating Collections

SonicJS offers two ways to create collections: through the admin UI or with code. Each approach has its own advantages depending on your workflow and requirements.

### Comparison: UI vs Code-Based Collections

| Aspect              | Admin UI                                            | Code-Based                                    |
| ------------------- | --------------------------------------------------- | --------------------------------------------- |
| **Best for**        | Rapid prototyping, non-developers, quick iterations | Production apps, team collaboration, CI/CD    |
| **Version control** | Not version controlled                              | Full git history                              |
| **Editing**         | Fully editable in admin                             | Read-only in admin (edit code instead)        |
| **Type safety**     | None                                                | Full TypeScript support with IDE autocomplete |
| **Deployment**      | Manual recreation per environment                   | Automatic sync across environments            |
| **Field types**     | Limited to active editor plugins                    | All 30+ field types available                 |

---

### Option 1: Creating Collections via Admin UI

The admin UI provides a visual interface for creating and managing collections without writing code.

#### Step 1: Access Collections

Navigate to `/admin/collections` in your browser. You'll see a list of all existing collections.

#### Step 2: Create New Collection

Click the **"New Collection"** button in the top right corner.

#### Step 3: Fill in Collection Details

<CodeGroup title="Collection Form Fields">

```
Display Name: Blog Posts
Collection Name: blog_posts (lowercase, numbers, underscores only)
Description: Manage your blog content (optional)
```

</CodeGroup>

Click **"Create Collection"** to save. You'll be redirected to the collection edit page.

#### Step 4: Add Fields

On the collection edit page, click **"Add Field"** to open the field modal. Configure each field with:

- **Field Name** - Machine name (lowercase, underscores)
- **Field Type** - Choose from: text, richtext, number, boolean, date, select, media
- **Field Label** - Human-readable display name
- **Required** - Whether the field must have a value
- **Searchable** - Include in content search results
- **Field Options** - JSON configuration for field-specific settings

<CodeGroup title="Example Field Options">

```json
// For select fields
{"options": ["draft", "published", "archived"]}

// For media fields
{"accept": "image/*", "maxSize": "10MB"}

// For text fields
{"maxLength": 200, "placeholder": "Enter title..."}
```

</CodeGroup>

#### Step 5: Manage Fields

After adding fields, you can:

- **Reorder** fields using drag handles
- **Edit** field settings by clicking the edit button
- **Delete** fields using the delete button

<Callout type="warning" title="UI-Created Collection Limitations">
  Collections created via UI have fewer field types available compared to
  code-based collections. Rich text editors (TinyMCE, Quill, EasyMDX) are only
  available if the corresponding plugin is active.
</Callout>

---

### Option 2: Creating Collections with Code

Code-based collections provide type safety, version control, and the full range of field types.

#### Step 1: Create Collection File

Create a new file in `src/collections/` with a `.collection.ts` extension:

<CodeGroup title="Blog Posts Collection">

```typescript
// src/collections/blog-posts.collection.ts
import type { CollectionConfig } from '@sonicjs-cms/core'

export default {
  name: 'blog_posts',
  displayName: 'Blog Posts',
  description: 'Articles and blog content',
  icon: 'üìù',

  schema: {
    type: 'object',
    properties: {
      title: {
        type: 'string',
        title: 'Title',
        required: true,
        minLength: 3,
        maxLength: 200,
      },
      slug: {
        type: 'slug',
        title: 'URL Slug',
        required: true,
      },
      content: {
        type: 'richtext',
        title: 'Content',
        required: true,
      },
      excerpt: {
        type: 'textarea',
        title: 'Excerpt',
        maxLength: 500,
        helpText: 'A short summary of the post',
      },
      author: {
        type: 'reference',
        title: 'Author',
        collection: 'users',
        required: true,
      },
      publishDate: {
        type: 'datetime',
        title: 'Publish Date',
        required: true,
      },
      status: {
        type: 'select',
        title: 'Status',
        enum: ['draft', 'published', 'archived'],
        enumLabels: ['Draft', 'Published', 'Archived'],
        default: 'draft',
      },
    },
    required: ['title', 'slug', 'content', 'author', 'publishDate'],
  },

  // Display configuration
  listFields: ['title', 'author', 'publishDate', 'status'],
  searchFields: ['title', 'excerpt', 'content'],
  defaultSort: 'createdAt',
  defaultSortOrder: 'desc',

  // Mark as config-managed (read-only in admin UI)
  managed: true,
  isActive: true,
} satisfies CollectionConfig
```

</CodeGroup>

#### Step 2: Register the Collection

In your application entry point, register your collections:

<CodeGroup title="Register Collections">

```typescript
// src/index.ts
import { createSonicJSApp, registerCollections } from '@sonicjs-cms/core'
import blogPostsCollection from './collections/blog-posts.collection'

// Register custom collections
registerCollections([blogPostsCollection])

// Create and export the app
export default createSonicJSApp({
  collections: {
    autoSync: true,
  },
})
```

</CodeGroup>

#### Step 3: Sync Collections

Collections are automatically synced on server startup. You can also manually sync:

<CodeGroup title="Sync Collections">

```bash
# Collections auto-sync on server restart
npm run dev

# Or manually sync
npm run sync-collections
```

</CodeGroup>

<Callout type="info" title="Config Badge in Admin UI">
  Code-based collections appear in the admin UI with a purple **"Config"** badge
  and are read-only. To modify them, edit the TypeScript file and restart the
  server.
</Callout>

---

### When to Use Each Approach

**Use the Admin UI when:**

- Prototyping a new content model quickly
- Non-developers need to create collections
- You need to iterate on schema design rapidly
- Building a one-off project without deployment concerns

**Use Code-Based collections when:**

- Building production applications
- Working with a team (version control is essential)
- You need type safety and IDE autocomplete
- Deploying across multiple environments (staging, production)
- Using CI/CD pipelines
- You need advanced field types or validation

<Callout type="tip" title="Migration Path">
  You can start with UI-created collections for prototyping, then convert them
  to code-based collections for production. Export the schema JSON from the
  database and convert it to a TypeScript collection file.
</Callout>

---

## Field Types

SonicJS supports 30+ field types for building rich content schemas:

### Text Fields

<Properties>
  <Property name="string" type="string">
    Single-line text input. Use for titles, names, short text.
  </Property>
  <Property name="textarea" type="string">
    Multi-line plain text. Use for descriptions, notes, long text.
  </Property>
  <Property name="email" type="string">
    Email with validation. Use for contact emails, author info.
  </Property>
  <Property name="url" type="string">
    URL with validation. Use for links, external resources.
  </Property>
  <Property name="slug" type="string">
    URL-friendly identifier. Use for page URLs, SEO paths.
  </Property>
  <Property name="color" type="string">
    Color picker. Use for theme colors, UI customization.
  </Property>
</Properties>

### Rich Content

<Properties>
  <Property name="richtext" type="string">
    WYSIWYG HTML editor. Use for blog posts, articles, formatted content.
  </Property>
  <Property name="markdown" type="string">
    Markdown editor. Use for documentation, technical content.
  </Property>
  <Property name="json" type="object">
    JSON editor. Use for structured data, API responses.
  </Property>
</Properties>

### Numbers and Dates

<Properties>
  <Property name="number" type="number">
    Numeric input. Use for prices, quantities, ratings.
  </Property>
  <Property name="date" type="string">
    Date picker (no time). Use for birthdays, deadlines.
  </Property>
  <Property name="datetime" type="string">
    Date and time picker. Use for publish dates, events.
  </Property>
</Properties>

### Selections

<Properties>
  <Property name="select" type="string">
    Dropdown (single choice). Use for categories, status fields.
  </Property>
  <Property name="multiselect" type="array">
    Dropdown (multiple choices). Use for tags, multiple categories.
  </Property>
  <Property name="radio" type="string">
    Radio buttons. Use for status, visibility options.
  </Property>
  <Property name="checkbox" type="boolean">
    Boolean checkbox. Use for feature toggles, flags.
  </Property>
</Properties>

### Media and Files

<Properties>
  <Property name="media" type="string">
    Image/media picker. Use for featured images, avatars.
  </Property>
  <Property name="file" type="string">
    File upload. Use for PDFs, documents, downloads.
  </Property>
</Properties>

### Relationships

<Properties>
  <Property name="reference" type="string">
    Reference to another collection. Use for authors, categories.
  </Property>
  <Property name="array" type="array">
    Array of items. Can contain any field type.
  </Property>
</Properties>

### Content Blocks (Repeater)

Use an array field with `items.blocks` to define reusable content blocks (hero, text + image, testimonials, CTAs) with add/remove/reorder controls.

<CodeGroup title="Blocks Field">

```typescript
body: {
  type: 'array',
  title: 'Content Blocks',
  items: {
    type: 'object',
    discriminator: 'blockType',
    blocks: {
      text: {
        label: 'Text',
        properties: {
          heading: { type: 'string', title: 'Heading', required: true },
          body: { type: 'textarea', title: 'Body text', required: true }
        }
      },
      callToAction: {
        label: 'Call To Action',
        properties: {
          title: { type: 'string', title: 'Heading', required: true },
          body: { type: 'textarea', title: 'Body text', required: true },
          buttonLabel: { type: 'string', title: 'Button label',  required: true },
          buttonUrl: { type: 'url', title: 'Button link',  required: true }
        }
      }
    }
  }
}
```

</CodeGroup>

<Callout type="info" title="Availability">
  Blocks are currently supported for code-based collections only. The Admin UI
  collection builder does not yet expose block definitions.
</Callout>

---

## Validation

### Built-in Validators

<CodeGroup title="Field Validation">

```typescript
export const productsCollection: CollectionConfig = {
  name: 'products',
  displayName: 'Products',
  schema: {
    type: 'object',
    properties: {
      name: {
        type: 'string',
        required: true,
        minLength: 3,
        maxLength: 200,
      },
      sku: {
        type: 'string',
        required: true,
        pattern: '^[A-Z0-9-]+$', // Only uppercase, numbers, hyphens
      },
      price: {
        type: 'number',
        required: true,
        minimum: 0,
        maximum: 999999,
      },
      email: {
        type: 'email',
        required: true,
      },
      url: {
        type: 'url',
        required: false,
      },
      status: {
        type: 'select',
        enum: ['draft', 'active', 'archived'],
        default: 'draft',
      },
    },
  },
  managed: true,
  isActive: true,
}
```

</CodeGroup>

### Validation Rules

- **required** - Field must have a value
- **minLength** / **maxLength** - String length constraints
- **minimum** / **maximum** - Number range constraints
- **pattern** - Regular expression validation
- **enum** - Must be one of specified values
- **default** - Default value if not provided

---

## Examples

### E-commerce Product

<CodeGroup title="Product Collection">

```typescript
export const productsCollection: CollectionConfig = {
  name: 'products',
  displayName: 'Products',
  description: 'E-commerce product catalog',
  schema: {
    type: 'object',
    properties: {
      name: {
        type: 'string',
        required: true,
      },
      sku: {
        type: 'string',
        required: true,
      },
      price: {
        type: 'number',
        required: true,
        minimum: 0,
      },
      description: {
        type: 'richtext',
      },
      images: {
        type: 'array',
        items: {
          type: 'media',
          accept: 'image/*',
        },
      },
      category: {
        type: 'select',
        enum: ['electronics', 'clothing', 'home', 'sports'],
      },
      inStock: {
        type: 'boolean',
        default: true,
      },
      tags: {
        type: 'array',
        items: { type: 'string' },
      },
    },
  },
  icon: 'üõçÔ∏è',
  managed: true,
  isActive: true,
}
```

</CodeGroup>

### Documentation Page

<CodeGroup title="Docs Collection">

```typescript
export const docsCollection: CollectionConfig = {
  name: 'documentation',
  displayName: 'Documentation',
  schema: {
    type: 'object',
    properties: {
      title: {
        type: 'string',
        required: true,
      },
      slug: {
        type: 'slug',
        required: true,
      },
      content: {
        type: 'markdown',
        required: true,
      },
      category: {
        type: 'select',
        enum: ['getting-started', 'api', 'guides', 'reference'],
      },
      order: {
        type: 'number',
        default: 0,
      },
      published: {
        type: 'boolean',
        default: false,
      },
    },
  },
  icon: 'üìö',
  managed: true,
  isActive: true,
}
```

</CodeGroup>

### Event Management

<CodeGroup title="Events Collection">

```typescript
export const eventsCollection: CollectionConfig = {
  name: 'events',
  displayName: 'Events',
  schema: {
    type: 'object',
    properties: {
      title: {
        type: 'string',
        required: true,
      },
      description: {
        type: 'richtext',
      },
      startDate: {
        type: 'datetime',
        required: true,
      },
      endDate: {
        type: 'datetime',
        required: true,
      },
      location: {
        type: 'string',
      },
      virtualLink: {
        type: 'url',
      },
      capacity: {
        type: 'number',
        minimum: 1,
      },
      registration: {
        type: 'boolean',
        default: false,
      },
      organizer: {
        type: 'reference',
        collection: 'users',
      },
    },
  },
  icon: 'üìÖ',
  managed: true,
  isActive: true,
}
```

</CodeGroup>

---

## Using Collections

### Query Content

<CodeGroup title="Fetch Collection Content">

```typescript
// Get all content from a collection
const posts = await db
  .select()
  .from(content)
  .where(eq(content.collection_id, 'blog_posts'))
  .orderBy(desc(content.created_at))
  .limit(10)

// Get single content item
const post = await db.select().from(content).where(eq(content.id, postId)).get()

// Search content
const results = await db
  .select()
  .from(content)
  .where(
    and(
      eq(content.collection_id, 'blog_posts'),
      like(content.title, '%search%'),
    ),
  )
  .all()
```

</CodeGroup>

### API Endpoints

Collections automatically get REST API endpoints:

<ApiEndpoint
  method="GET"
  path="/api/collections/{collection}/content"
  description="Get all content from a collection"
  auth={false}
/>

<ApiEndpoint
  method="GET"
  path="/api/content/{id}"
  description="Get single content item"
  auth={false}
/>

<ApiEndpoint
  method="POST"
  path="/admin/content"
  description="Create new content"
  auth={true}
/>

<ApiEndpoint
  method="PUT"
  path="/admin/content/{id}"
  description="Update content"
  auth={true}
/>

<ApiEndpoint
  method="DELETE"
  path="/admin/content/{id}"
  description="Delete content"
  auth={true}
/>

---

## Best Practices

<Callout type="tip" title="Collection Design Tips">
  - Use descriptive field names that reflect your content model - Set
  appropriate validation rules to maintain data quality - Use references for
  relationships between collections - Enable search on fields that users will
  query frequently - Set reasonable defaults for optional fields
</Callout>

<Callout type="warning" title="Performance Considerations">
  - Limit the number of fields in `listFields` to improve list performance - Use
  appropriate field types (e.g., `select` instead of `string` for fixed options)
  - Index frequently queried fields in your database
</Callout>

---

## Next Steps

<div className="not-prose">
  <Button href="/api" variant="text" arrow="right">
    <>Explore the API reference</>
  </Button>
</div>

<div className="not-prose mt-4">
  <Button href="/database" variant="text" arrow="right">
    <>Learn about database management</>
  </Button>
</div>
