export const metadata = {
  title: 'Contributing - SonicJS',
  description:
    'Learn how to contribute to SonicJS. Set up the monorepo for core development, understand the project structure, and submit your first pull request.',
}

export const sections = [
  { title: 'Before You Start', id: 'before-you-start' },
  { title: 'Monorepo Setup', id: 'monorepo-setup' },
  { title: 'Project Structure', id: 'project-structure' },
  { title: 'Available Scripts', id: 'available-scripts' },
  { title: 'Contribution Process', id: 'contribution-process' },
  { title: 'Code Standards', id: 'code-standards' },
  { title: 'Troubleshooting', id: 'troubleshooting' },
]

# Contributing to SonicJS

This guide is for developers who want to contribute to the SonicJS platform itself. If you're building an application with SonicJS, see the [Installation](/installation) guide instead. {{ className: 'lead' }}

---

## Before You Start

We appreciate every developer who wants to contribute to SonicJS. To ensure the best experience for both contributors and maintainers, we've established a clear process for getting involved.

<div className="not-prose mb-8 p-6 rounded-lg border-2 border-amber-200 dark:border-amber-800 bg-amber-50 dark:bg-amber-900/20">
  <div className="flex items-start gap-4">
    <div className="text-3xl">ğŸ’¡</div>
    <div>
      <h3 className="text-lg font-semibold mb-2 m-0 text-amber-900 dark:text-amber-100">Important: Start with Code, Not Meetings</h3>
      <p className="text-amber-800 dark:text-amber-200 mb-0">We receive many requests from developers interested in contributing. While we value every potential contributor, we've found that the most effective way to get involved is to <strong>demonstrate your commitment through contributions first</strong>. Please submit at least one meaningful pull request before requesting a meeting or deeper integration into the project.</p>
    </div>
  </div>
</div>

### What Counts as a Meaningful Contribution?

<FeatureGrid
  features={[
    {
      icon: 'ğŸ›',
      title: 'Bug Fixes',
      description: 'Fix a bug from the issue tracker with a well-tested solution',
    },
    {
      icon: 'âœ¨',
      title: 'New Features',
      description: 'Implement a feature that has been discussed and approved',
    },
    {
      icon: 'ğŸ“',
      title: 'Documentation',
      description: 'Significantly improve or add documentation',
    },
    {
      icon: 'ğŸ§ª',
      title: 'Test Coverage',
      description: 'Add meaningful tests for untested functionality',
    },
    {
      icon: 'ğŸ¬',
      title: 'Video Content',
      description: 'Create tutorials, walkthroughs, or feature demos for YouTube',
    },
  ]}
  columns={2}
/>

### Create Video Content

We're looking for contributors to create video content for our [YouTube channel](https://www.youtube.com/@sonicjs). Video tutorials help developers learn SonicJS faster and reach a wider audience.

**Video ideas:**
- Getting started tutorials
- Feature walkthroughs and demos
- Building real-world projects with SonicJS
- Plugin development guides
- Tips and tricks

Reach out via [GitHub Discussions](https://github.com/lane711/sonicjs/discussions) if you're interested in creating video content.

---

## Monorepo Setup

SonicJS uses a **monorepo** structure managed by npm workspaces. This allows us to develop the core framework, CLI tools, and documentation in a single repository.

### Clone the Repository

```bash {{ title: 'Clone & Install' }}
# Fork the repository on GitHub first
# Then clone your fork:
git clone https://github.com/YOUR_USERNAME/sonicjs.git
cd sonicjs

# Add upstream remote
git remote add upstream https://github.com/lane711/sonicjs.git

# Install all dependencies (installs for all workspaces)
npm install
```

### Start Development Server

```bash {{ title: 'Start Development' }}
# Start the development application
npm run dev

# Or start the documentation site
npm run dev:www
```

The development server runs at **http://localhost:8787**

---

## Project Structure

The SonicJS monorepo is organized as follows:

```
sonicjs/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/                    # @sonicjs-cms/core - The main framework
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts        # Package entry point
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/     # Request middleware
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/         # HTTP route handlers
â”‚   â”‚   â”‚   â”œâ”€â”€ services/       # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ templates/      # HTML templates
â”‚   â”‚   â”‚   â”œâ”€â”€ plugins/        # Plugin system
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ core/       # Plugin architecture
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ core-plugins/  # Built-in plugins
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ available/  # Optional plugins
â”‚   â”‚   â”‚   â”œâ”€â”€ collections/    # Collection definitions
â”‚   â”‚   â”‚   â””â”€â”€ types/          # TypeScript types
â”‚   â”‚   â”œâ”€â”€ migrations/         # Database migrations
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ create-app/             # create-sonicjs CLI tool
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ cli.js          # CLI entry point
â”‚       â”œâ”€â”€ templates/
â”‚       â”‚   â””â”€â”€ starter/        # Starter project template
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ www/                        # Documentation website (Next.js)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ app/               # MDX documentation pages
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ my-sonicjs-app/            # Development/test application
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ index.ts           # App entry point
â”‚   â”œâ”€â”€ wrangler.toml          # Cloudflare config
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ tests/                      # E2E tests
â”‚   â”œâ”€â”€ e2e/                   # Playwright tests
â”‚   â””â”€â”€ playwright.config.ts
â”‚
â”œâ”€â”€ docs/                       # Internal documentation
â”œâ”€â”€ package.json               # Root package.json (workspaces)
â””â”€â”€ README.md
```

### Key Directories

| Directory | Description |
|-----------|-------------|
| `packages/core` | The core SonicJS framework published as `@sonicjs-cms/core` |
| `packages/create-app` | The `create-sonicjs` CLI tool for scaffolding new projects |
| `www` | Documentation website built with Next.js |
| `my-sonicjs-app` | Development application for testing changes |
| `tests` | End-to-end tests using Playwright |

---

## Available Scripts

### Root Level Scripts

Run these from the repository root:

| Command | Description |
|---------|-------------|
| `npm run dev` | Start development server (my-sonicjs-app) |
| `npm run dev:www` | Start documentation site |
| `npm run build` | Build core package and development app |
| `npm run build:core` | Build only the core package |
| `npm run build:www` | Build documentation site |
| `npm test` | Run core package unit tests |
| `npm run test:e2e` | Run Playwright end-to-end tests |
| `npm run deploy` | Deploy development app to Cloudflare |
| `npm run deploy:www` | Deploy documentation site |

### Database Scripts

| Command | Description |
|---------|-------------|
| `npm run db:generate` | Generate migration files from schema changes |
| `npm run db:migrate` | Apply migrations to local D1 database |
| `npm run db:migrate:prod` | Apply migrations to production database |
| `npm run db:studio` | Open Drizzle Studio (database GUI) |

### Testing Scripts

| Command | Description |
|---------|-------------|
| `npm test` | Run Vitest unit tests |
| `npm run test:watch` | Run tests in watch mode |
| `npm run test:cov` | Run tests with coverage report |
| `npm run test:e2e` | Run Playwright E2E tests |
| `npm run test:e2e:ui` | Run E2E tests with UI mode |

### Plugin Scripts

| Command | Description |
|---------|-------------|
| `npm run plugins:generate` | Regenerate plugin registry from manifests |
| `npm run plugins:watch` | Watch plugin manifests and auto-regenerate |

---

## Contribution Process

### Step 1: Find Something to Work On

Browse our [GitHub Issues](https://github.com/lane711/sonicjs/issues) to find something to work on:

<div className="not-prose mb-8">
  <div className="grid grid-cols-1 gap-6 md:grid-cols-2">
    <a href="https://github.com/lane711/sonicjs/labels/good%20first%20issue" className="flex flex-col rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 hover:border-zinc-300 dark:hover:border-zinc-700 transition">
      <div className="text-2xl mb-3">ğŸ·ï¸</div>
      <h3 className="text-lg font-semibold mb-2 m-0">Good First Issues</h3>
      <p className="text-sm text-zinc-600 dark:text-zinc-400">Issues tagged for newcomers - great starting point</p>
    </a>

    <a href="https://github.com/lane711/sonicjs/labels/help%20wanted" className="flex flex-col rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 hover:border-zinc-300 dark:hover:border-zinc-700 transition">
      <div className="text-2xl mb-3">ğŸ™‹</div>
      <h3 className="text-lg font-semibold mb-2 m-0">Help Wanted</h3>
      <p className="text-sm text-zinc-600 dark:text-zinc-400">Issues where we actively need community help</p>
    </a>

    <a href="https://github.com/lane711/sonicjs/issues" className="flex flex-col rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 hover:border-zinc-300 dark:hover:border-zinc-700 transition">
      <div className="text-2xl mb-3">ğŸ”</div>
      <h3 className="text-lg font-semibold mb-2 m-0">All Issues</h3>
      <p className="text-sm text-zinc-600 dark:text-zinc-400">Browse all open issues and find one that interests you</p>
    </a>

    <a href="https://github.com/lane711/sonicjs/labels/documentation" className="flex flex-col rounded-lg border border-zinc-200 dark:border-zinc-800 p-6 hover:border-zinc-300 dark:hover:border-zinc-700 transition">
      <div className="text-2xl mb-3">ğŸ“š</div>
      <h3 className="text-lg font-semibold mb-2 m-0">Documentation</h3>
      <p className="text-sm text-zinc-600 dark:text-zinc-400">Help improve our docs - great for learning the project</p>
    </a>
  </div>
</div>

### Step 2: Create a Feature Branch

```bash
# Sync with upstream
git fetch upstream
git checkout main
git merge upstream/main

# Create a feature branch
git checkout -b feature/your-feature-name
```

### Step 3: Make Your Changes

1. Make your changes in the appropriate package
2. Write tests for new functionality
3. Run tests to ensure everything passes
4. Update documentation if needed

Have questions? Ask in our [Discord server](https://discord.gg/SJArGfJgPJ) - we're happy to help!

### Step 4: Submit Your Pull Request

```bash
# Commit your changes
git add .
git commit -m "feat: add your feature description"

# Push to your fork
git push origin feature/your-feature-name
```

Then create a Pull Request on GitHub.

### Step 5: After Your First PR is Merged

<div className="not-prose mb-8 p-6 rounded-lg border border-emerald-200 dark:border-emerald-800 bg-emerald-50 dark:bg-emerald-900/20">
  <div className="flex items-start gap-4">
    <div className="text-3xl">ğŸ‰</div>
    <div>
      <h3 className="text-lg font-semibold mb-2 m-0 text-emerald-900 dark:text-emerald-100">Congratulations!</h3>
      <p className="text-emerald-800 dark:text-emerald-200 mb-4">After your first meaningful contribution is merged, you'll be:</p>
      <ul className="text-emerald-800 dark:text-emerald-200 list-disc list-inside space-y-1 mb-0">
        <li>Added to our contributors list</li>
        <li>Eligible for deeper project discussions</li>
        <li>Welcome to schedule a call with maintainers if desired</li>
        <li>Considered for more significant responsibilities</li>
      </ul>
    </div>
  </div>
</div>

---

## Code Standards

### General Guidelines

- **TypeScript**: All code must be in TypeScript with proper types
- **Testing**: New features must include tests
- **Documentation**: Public APIs must be documented
- **Formatting**: Use Prettier (runs automatically on commit)
- **Linting**: ESLint rules must pass

### Commit Messages

We use conventional commit messages. Reference issue numbers when applicable.

```bash
feat: add new caching strategy
fix: resolve authentication bug (#123)
docs: update installation guide
test: add tests for plugin loader
```

### Pull Request Checklist

Before submitting a PR, ensure:

- [ ] All tests pass (`npm test`)
- [ ] E2E tests pass (`npm run test:e2e`)
- [ ] Code is formatted (`npm run format`)
- [ ] Linting passes (`npm run lint`)
- [ ] Changes are documented if needed
- [ ] PR description explains the changes
- [ ] Related issue is referenced

---

## Troubleshooting

### Common Issues

#### Database Connection Errors

**Error:** `Error: no such table: users`

**Solution:**

```bash
# Run migrations
npm run db:migrate

# Verify migration status
wrangler d1 migrations list DB --local
```

---

#### Port Already in Use

**Error:** `Error: listen EADDRINUSE: address already in use :::8787`

**Solution:**

```bash
# Find and kill the process using port 8787
lsof -ti:8787 | xargs kill -9
```

---

#### Module Not Found / Import Errors

**Error:** `Cannot find module 'hono'`

**Solution:**

```bash
# Clear and reinstall dependencies
rm -rf node_modules package-lock.json
npm install

# Clear TypeScript build cache
rm -rf .wrangler
```

---

#### Build Failures

**Error:** Build fails when running `npm run build:core`

**Solution:**

1. Ensure you're using Node.js 18+
2. Clear build artifacts: `rm -rf packages/core/dist`
3. Reinstall dependencies: `npm install`
4. Try building again: `npm run build:core`

---

### Getting Help

**Resources:**

- ğŸ“š [Full Documentation](https://sonicjs.com)
- ğŸ› [GitHub Issues](https://github.com/lane711/sonicjs/issues)
- ğŸ’¬ [Discord](https://discord.gg/SJArGfJgPJ)

---

## Ready to Contribute?

<div className="not-prose mt-8">
  <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
    <Button href="https://github.com/lane711/sonicjs/issues" variant="primary">
      <>Find an Issue to Work On</>
    </Button>
    <Button href="https://github.com/lane711/sonicjs" variant="secondary">
      <>View Repository</>
    </Button>
  </div>
</div>

<div className="not-prose mt-4">
  <Button href="/community" variant="text" arrow="right">
    <>Join the Community</>
  </Button>
</div>

---

## Questions?

If you have questions about contributing:

1. **Check existing issues** - your question may already be answered
2. **Ask in [Discord](https://discord.gg/SJArGfJgPJ)** - for general questions
3. **Comment on the issue** - for specific issue clarifications

We look forward to your contributions!
